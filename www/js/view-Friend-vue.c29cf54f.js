(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["view-Friend-vue"],{"28a5":function(e,t,n){"use strict";var s=n("aae3"),r=n("cb7c"),i=n("ebd6"),a=n("0390"),c=n("9def"),o=n("5f1b"),u=n("520a"),l=n("79e5"),d=Math.min,f=[].push,h="split",p="length",g="lastIndex",v=4294967295,m=!l((function(){RegExp(v,"y")}));n("214f")("split",2,(function(e,t,n,l){var b;return b="c"=="abbc"[h](/(b)*/)[1]||4!="test"[h](/(?:)/,-1)[p]||2!="ab"[h](/(?:ab)*/)[p]||4!="."[h](/(.?)(.?)/)[p]||"."[h](/()()/)[p]>1||""[h](/.?/)[p]?function(e,t){var r=String(this);if(void 0===e&&0===t)return[];if(!s(e))return n.call(r,e,t);var i,a,c,o=[],l=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),d=0,h=void 0===t?v:t>>>0,m=new RegExp(e.source,l+"g");while(i=u.call(m,r)){if(a=m[g],a>d&&(o.push(r.slice(d,i.index)),i[p]>1&&i.index<r[p]&&f.apply(o,i.slice(1)),c=i[0][p],d=a,o[p]>=h))break;m[g]===i.index&&m[g]++}return d===r[p]?!c&&m.test("")||o.push(""):o.push(r.slice(d)),o[p]>h?o.slice(0,h):o}:"0"[h](void 0,0)[p]?function(e,t){return void 0===e&&0===t?[]:n.call(this,e,t)}:n,[function(n,s){var r=e(this),i=void 0==n?void 0:n[t];return void 0!==i?i.call(n,r,s):b.call(String(r),n,s)},function(e,t){var s=l(b,e,this,t,b!==n);if(s.done)return s.value;var u=r(e),f=String(this),h=i(u,RegExp),p=u.unicode,g=(u.ignoreCase?"i":"")+(u.multiline?"m":"")+(u.unicode?"u":"")+(m?"y":"g"),y=new h(m?u:"^(?:"+u.source+")",g),O=void 0===t?v:t>>>0;if(0===O)return[];if(0===f.length)return null===o(y,f)?[f]:[];var _=0,w=0,C=[];while(w<f.length){y.lastIndex=m?w:0;var F,x=o(y,m?f:f.slice(w));if(null===x||(F=d(c(y.lastIndex+(m?0:w)),f.length))===_)w=a(f,w,p);else{if(C.push(f.slice(_,w)),C.length===O)return C;for(var j=1;j<=x.length-1;j++)if(C.push(x[j]),C.length===O)return C;w=_=F}}return C.push(f.slice(_)),C}]}))},"2fdb":function(e,t,n){"use strict";var s=n("5ca1"),r=n("d2c8"),i="includes";s(s.P+s.F*n("5147")(i),"String",{includes:function(e){return!!~r(this,e,i).indexOf(e,arguments.length>1?arguments[1]:void 0)}})},"386d":function(e,t,n){"use strict";var s=n("cb7c"),r=n("83a1"),i=n("5f1b");n("214f")("search",1,(function(e,t,n,a){return[function(n){var s=e(this),r=void 0==n?void 0:n[t];return void 0!==r?r.call(n,s):new RegExp(n)[t](String(s))},function(e){var t=a(n,e,this);if(t.done)return t.value;var c=s(e),o=String(this),u=c.lastIndex;r(u,0)||(c.lastIndex=0);var l=i(c,o);return r(c.lastIndex,u)||(c.lastIndex=u),null===l?-1:l.index}]}))},"3b2b":function(e,t,n){var s=n("7726"),r=n("5dbc"),i=n("86cc").f,a=n("9093").f,c=n("aae3"),o=n("0bfb"),u=s.RegExp,l=u,d=u.prototype,f=/a/g,h=/a/g,p=new u(f)!==f;if(n("9e1e")&&(!p||n("79e5")((function(){return h[n("2b4c")("match")]=!1,u(f)!=f||u(h)==h||"/a/i"!=u(f,"i")})))){u=function(e,t){var n=this instanceof u,s=c(e),i=void 0===t;return!n&&s&&e.constructor===u&&i?e:r(p?new l(s&&!i?e.source:e,t):l((s=e instanceof u)?e.source:e,s&&i?o.call(e):t),n?this:d,u)};for(var g=function(e){e in u||i(u,e,{configurable:!0,get:function(){return l[e]},set:function(t){l[e]=t}})},v=a(l),m=0;v.length>m;)g(v[m++]);d.constructor=u,u.prototype=d,n("2aba")(s,"RegExp",u)}n("7a56")("RegExp")},"50d0":function(e,t,n){},5147:function(e,t,n){var s=n("2b4c")("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[s]=!1,!"/./"[e](t)}catch(r){}}return!0}},"5ac0":function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("grid-content",[n("div",{attrs:{slot:"menu"},slot:"menu"},[n("h2",{staticClass:"button primary",on:{click:e.openSearch}},[n("font-awesome-icon",{attrs:{icon:"search"}}),e._v("\n            Search friends\n        ")],1),n("ul",{staticClass:"link-list"},e._l(e.getFriends,(function(t,s){return n("li",{key:s,class:{online:"CONNECTED"===t.contact_state}},[n("router-link",{staticClass:"link",attrs:{"active-class":"active",to:{name:"friend",params:{id:t.username}}}},[e._v("\n                    "+e._s(t.username)+"\n                ")])],1)})),0),n("p",{staticClass:"info"},[n("font-awesome-icon",{attrs:{icon:"info-circle"}}),e._v("\n            You can only send messages to a friend that is online.\n        ")],1)]),n("div",{attrs:{slot:"main"},slot:"main"},[e.getCurrentFriend?n("friend-chat",{attrs:{"current-friend":e.getCurrentFriend}}):n("div",[e._v("\n            Select a friend to chat !\n        ")]),e.isSearchOpen?n("div",{staticClass:"search"},[n("div",{staticClass:"inner-container"},[n("span",{staticClass:"close-main",on:{click:e.closeSearch}},[n("font-awesome-icon",{attrs:{icon:"times"}})],1),n("label",{attrs:{for:"search"}},[e._v("\n                    Search friends\n                ")]),n("div",{staticClass:"input-wrapper"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.search,expression:"search"}],ref:"searchInput",attrs:{placeholder:"Type your friend name",id:"search"},domProps:{value:e.search},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchUser(t)},input:function(t){t.target.composing||(e.search=t.target.value)}}}),n("button",{staticClass:"button primary search-user",class:{"is-loading":e.isLoading},attrs:{disabled:this.search.length<3||e.isLoading},on:{click:e.searchUser}},[e.isLoading?n("font-awesome-icon",{staticClass:"loading rotating",attrs:{icon:"spinner"}}):e._e(),n("span",[e._v("Search")])],1)]),e.addFriendResponse?n("div",{staticClass:"add-friend-response"},[n("span",{on:{click:function(t){e.addFriendResponse=null}}},[n("font-awesome-icon",{attrs:{icon:"times"}})],1),e._v("\n\n                    "+e._s(e.addFriendResponse.result[0])+"\n                ")]):e._e(),n("ul",{staticClass:"friends-list"},e._l(e.searchResults,(function(t){return n("li",{key:t.nickname},["exist"===t.result?n("div",[n("div",{staticClass:"item",on:{click:function(n){return e.addFriend(t.idurl)}}},[n("font-awesome-icon",{staticClass:"icon",attrs:{icon:"user-plus"}}),n("p",[e._v(e._s(t.nickname))])],1)]):e._e(),"not exist"===t.result?n("div",[n("h4",[e._v("\n                                No results for: "+e._s(t.nickname)+"\n                            ")])]):e._e()])})),0),e.observeSearchAlias.length>1?n("div",[n("h2",[e._v("Other results")]),n("ul",{staticClass:"friends-list"},e._l(e.searchResults,(function(t){return n("li",{key:t.nickname},[n("div",{staticClass:"item",on:{click:function(n){return e.addFriend(t.idurl)}}},[n("font-awesome-icon",{staticClass:"icon",attrs:{icon:"user-plus"}}),n("p",[e._v(e._s(t.nickname))])],1)])})),0)]):e._e()])]):e._e()],1)])},r=[],i=(n("8e6e"),n("ac6a"),n("456d"),n("386d"),n("96cf"),n("3b8d")),a=(n("7514"),n("bd86")),c=n("2f62"),o=n("7424"),u=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"friend-chat"},[n("div",{staticClass:"friend-header"},[n("span",{staticClass:"remove",on:{click:function(t){return e.removeFriend(e.currentFriend.global_id)}}},[e._v("remove friend")])]),n("friend-messages",{attrs:{"current-friend":e.currentFriend}}),"CONNECTED"===e.currentFriend.contact_state?n("div",{staticClass:"message-sender"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.userMessage,expression:"userMessage"}],ref:"chat",staticClass:"chat-input",attrs:{placeholder:"Type here...",disabled:e.isSending,rows:e.lines},domProps:{value:e.userMessage},on:{keydown:e.sendFromEnter,input:function(t){t.target.composing||(e.userMessage=t.target.value)}}}),n("button",{staticClass:"send",on:{click:e.sendMessage}},[e._v("\n            Send\n        ")])]):e._e()],1)},l=[],d=(n("3b2b"),n("a481"),n("28a5"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"friend-messages"},[n("div",{staticClass:"messages",attrs:{id:"messages"}},[n("div",{ref:"message",staticClass:"messages-wrapper"},[n("ul",e._l(e.oldMessages,(function(t,s){return n("li",{key:s,class:{mine:t.doc.sender.glob_id.replace("master$","")!==e.currentFriend.global_id}},[n("div",[n("p",{staticClass:"user"},[e._v("\n                            "+e._s(t.doc.sender.glob_id.replace("master$","").replace(/\@(.*)/g,""))+"\n                        ")]),n("p",{staticClass:"message"},[e._v(e._s(t.doc.payload.data.message))])]),n("p",{staticClass:"message-time"},[e._v("\n                        "+e._s(new Date(1e3*t.doc.payload.time).toLocaleString())+"\n                    ")])])})),0),n("ul",e._l(e.userMessages,(function(t,s){return n("li",{key:s,class:{mine:t.sender.replace("master$","")!==e.currentFriend.global_id}},[n("div",[n("p",{staticClass:"user"},[e._v("\n                            "+e._s(t.sender.replace("master$","").replace(/\@(.*)/g,""))+"\n                        ")]),n("p",{staticClass:"message"},[e._v(e._s(t.data.message))])]),n("p",{staticClass:"message-time"},[e._v("\n                        "+e._s(new Date(1e3*t.time).toLocaleString())+"\n                    ")])])})),0)])])])}),f=[];n("6762"),n("2fdb");function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(n,!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var g={name:"FriendMessages",props:{currentFriend:{type:Object}},data:function(){return{history:[],oldMessages:[]}},methods:p({},Object(c["b"])(["resetMessages"]),{loadChatHistory:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o["a"].getMessageHistoryForUser(this.currentFriend);case 3:t=e.sent,this.oldMessages=[],this.oldMessages=t.result.reverse(),this.scrollDown(),e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](0),console.log("Error getting history");case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));function t(){return e.apply(this,arguments)}return t}(),scrollDown:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=window.innerWidth>=768?this.main:this.messages;setTimeout((function(){n.scroll({top:e.$refs.message.scrollHeight,behavior:t?"smooth":"instant"})}),40)}}),computed:p({},Object(c["c"])(["getMessages"]),{userMessages:function(){var e=this;if(this.getMessages)return this.getMessages.filter((function(t){if(t&&e.currentFriend.global_id){var n=t.sender.replace("master$","");return n.includes(e.currentFriend.global_id.toLowerCase())||t.recipient.toLowerCase().includes(e.currentFriend.global_id.toLowerCase())}}))}}),mounted:function(){this.messages=document.getElementById("messages"),this.main=document.getElementById("main"),this.main.classList.add("chat"),this.loadChatHistory()},watch:{$route:function(){this.resetMessages(),this.loadChatHistory()},getMessages:function(){this.scrollDown(!0)}}},v=g,m=(n("8130"),n("2877")),b=Object(m["a"])(v,d,f,!1,null,"7f9a76f4",null),y=b.exports,O=n("5648");function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(n,!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var C={components:{friendMessages:y},props:{currentFriend:{type:Object}},data:function(){return{message:"",isSending:!1,chat:"",rows:1}},computed:{lines:function(){if(this.hasLine(this.userMessage))return this.resetOpenFriend(),1;var e=this.userMessage.split(/\r|\r\n|\n/);return e.length},userMessage:{get:function(){return this.message.replace(/^[ \t]+/,"")},set:function(e){this.message=e}}},methods:w({},Object(c["b"])(["removeFriend"]),{hasLine:function(e){var t=/^\s*$/g,n=new RegExp(t);return n.test(e)},sendMessage:function(){var e=this;this.userMessage.length<1||(this.isSending=!0,O["a"].sendMessage({message:this.userMessage,user:this.currentFriend}).then((function(t){console.log("Message was sent"),e.isSending=!1})).catch((function(){})),this.resetOpenFriend())},resetOpenFriend:function(){var e=this;this.message="",setTimeout((function(){e.isSending=!1,e.focusOnInput()}),20)},sendFromEnter:function(e){13===e.keyCode&&(e.shiftKey||this.sendMessage())},focusOnInput:function(){var e=this;this.$refs.chat&&"CONNECTED"===this.currentFriend.contact_state&&this.$nextTick((function(){e.$refs.chat.focus()}))}}),mounted:function(){this.focusOnInput()},watch:{$route:function(){this.focusOnInput(),this.resetOpenFriend()}}},F=C,x=(n("ecd5"),Object(m["a"])(F,u,l,!1,null,"9f1c8a22",null)),j=x.exports,k=n("83f9");function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(n,!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var M={name:"Friend",data:function(){return{isSearchOpen:!1,search:"",searchResults:[],observeSearchAlias:[],addFriendResponse:"",isLoading:!1}},components:{FriendChat:j,GridContent:k["a"]},computed:E({},Object(c["c"])(["getFriends","getLastFriend","connectionStatus"]),{getCurrentFriend:function(){var e=this;return this.getFriends.find((function(t){return t.username===e.$route.params.id}))}}),methods:E({},Object(c["b"])(["getApiFriends","updateLastFriend"]),{openSearch:function(){var e=this;this.isSearchOpen=!0,this.$nextTick((function(){e.$refs.searchInput.focus()}))},closeSearch:function(){this.isSearchOpen=!1,this.search="",this.observeSearchAlias=[],this.searchResults=[],this.addFriendResponse=""},searchUser:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(this.search.length<3)){e.next=2;break}return e.abrupt("return");case 2:return this.isLoading=!0,e.prev=3,e.next=6,o["a"].searchUser(this.search);case 6:t=e.sent,n=t.result,this.searchResults=n,"exist"===n[0].result?this.observeSearchResult(n[0].nickname):this.observeSearchAlias=[],e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](3),console.log("Error searching",e.t0);case 15:this.isLoading=!1;case 16:case"end":return e.stop()}}),e,this,[[3,12]])})));function t(){return e.apply(this,arguments)}return t}(),observeSearchResult:function(e){var t=this;o["a"].observeUser(e).then((function(e){t.observeSearchAlias=e.result}))},addFriend:function(e){var t=this;o["a"].addFriend(e).then((function(e){t.addFriendResponse=e,t.getApiFriends()}))}}),created:function(){this.getApiFriends(),!this.getCurrentFriend&&this.getLastFriend&&this.$router.push({name:"friend",params:{id:this.getLastFriend.username}}),document.getElementsByTagName("html")[0].classList.remove("intro-background")},watch:{connectionStatus:function(){this.getApiFriends()},getCurrentFriend:function(e){e&&this.updateLastFriend(e)}}},P=M,R=(n("ab20"),Object(m["a"])(P,s,r,!1,null,"4f8eda82",null));t["default"]=R.exports},"5dbc":function(e,t,n){var s=n("d3f4"),r=n("8b97").set;e.exports=function(e,t,n){var i,a=t.constructor;return a!==n&&"function"==typeof a&&(i=a.prototype)!==n.prototype&&s(i)&&r&&r(e,i),e}},6762:function(e,t,n){"use strict";var s=n("5ca1"),r=n("c366")(!0);s(s.P,"Array",{includes:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}}),n("9c6c")("includes")},8130:function(e,t,n){"use strict";var s=n("8461"),r=n.n(s);r.a},"83a1":function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},"83f9":function(e,t,n){"use strict";var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container"},[n("div",{staticClass:"menu"},[e._t("menu")],2),n("div",{ref:"main",staticClass:"main",attrs:{id:"main"}},[e._t("main")],2)])},r=[],i={name:"GridContent"},a=i,c=(n("b345"),n("2877")),o=Object(c["a"])(a,s,r,!1,null,"b632edf8",null);t["a"]=o.exports},8461:function(e,t,n){},"8b97":function(e,t,n){var s=n("d3f4"),r=n("cb7c"),i=function(e,t){if(r(e),!s(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,s){try{s=n("9b43")(Function.call,n("11e9").f(Object.prototype,"__proto__").set,2),s(e,[]),t=!(e instanceof Array)}catch(r){t=!0}return function(e,n){return i(e,n),t?e.__proto__=n:s(e,n),e}}({},!1):void 0),check:i}},aae3:function(e,t,n){var s=n("d3f4"),r=n("2d95"),i=n("2b4c")("match");e.exports=function(e){var t;return s(e)&&(void 0!==(t=e[i])?!!t:"RegExp"==r(e))}},ab20:function(e,t,n){"use strict";var s=n("eaa5"),r=n.n(s);r.a},b345:function(e,t,n){"use strict";var s=n("c720"),r=n.n(s);r.a},c720:function(e,t,n){},d2c8:function(e,t,n){var s=n("aae3"),r=n("be13");e.exports=function(e,t,n){if(s(t))throw TypeError("String#"+n+" doesn't accept regex!");return String(r(e))}},eaa5:function(e,t,n){},ecd5:function(e,t,n){"use strict";var s=n("50d0"),r=n.n(s);r.a}}]);
//# sourceMappingURL=view-Friend-vue.c29cf54f.js.map